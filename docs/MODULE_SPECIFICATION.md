# מפרט מודולים מפורט - AN Projects
## מערכת ניהול פרויקטי בנייה ונדל"ן

---

## תוכן עניינים
1. [דשבורד (Dashboard)](#1-דשבורד-dashboard)
2. [פרויקטים (Projects)](#2-פרויקטים-projects)
3. [משימות ואבני דרך (Tasks & Milestones)](#3-משימות-ואבני-דרך-tasks--milestones)
4. [תקציב (Budget)](#4-תקציב-budget)
5. [אנשי מקצוע (Professionals)](#5-אנשי-מקצוע-professionals)
6. [מכרזים (Tenders)](#6-מכרזים-tenders)
7. [קבצים (Files)](#7-קבצים-files)
8. [רישוי (Permits/Licensing)](#8-רישוי-permitslicensing)
9. [שינויים בתכנון (Planning Changes)](#9-שינויים-בתכנון-planning-changes)
10. [בעיות מיוחדות (Special Issues)](#10-בעיות-מיוחדות-special-issues)
11. [תהליכים בין מודולים (Cross-Module Flows)](#g-תהליכים-בין-מודולים)
12. [קשרים בין מודולים (Module Relationships)](#h-קשרים-בין-מודולים)
13. [סיכום מצב נוכחי והמלצות](#i-סיכום-מצב-נוכחי-והמלצות)

---

# 1. דשבורד (Dashboard)

## א. כללי
| פרט | פירוט |
|-----|-------|
| **שם המודול** | דשבורד / Dashboard |
| **מטרה** | מבט על מצב כל הפרויקטים, התראות דחופות, ופעולות מהירות |
| **משתמשי יעד** | מנהלי פרויקטים, מנהלים ראשיים, יזמים |

## ב. מבנה נתונים

### ✅ קיים ומיושם

| שדה | טיפוס | חובה | תיאור |
|-----|-------|------|-------|
| **KPI Cards** | | | |
| label | string | ✓ | תווית המדד |
| value | number | ✓ | ערך המדד |
| icon | string | ✓ | שם אייקון |
| color | 'green' \| 'red' \| 'orange' \| 'blue' | ✓ | צבע |
| subtitle | string | ✗ | כותרת משנה |
| badge | string | ✗ | תג נוסף |
| **Alerts** | | | |
| id | string | ✓ | מזהה ייחודי |
| type | 'budget' \| 'delay' \| 'contract' \| 'other' | ✓ | סוג התראה |
| title | string | ✓ | כותרת |
| description | string | ✓ | תיאור |
| timestamp | string | ✓ | חותמת זמן |
| projectId | string | ✗ | קישור לפרויקט |
| projectName | string | ✗ | שם הפרויקט |

### 🟡 קיים חלקית
- **נתונים סטטיים** - הנתונים הם mock data ולא מחושבים מהנתונים האמיתיים
  - **עדיפות**: גבוהה
  - **מורכבות**: בינונית
  - **המלצה**: לחשב KPIs מנתוני פרויקטים, משימות ותקציב בזמן אמת

### ❌ חסר
- **התראות דינמיות** - אין מנגנון ליצירת התראות אוטומטיות
  - **עדיפות**: גבוהה
  - **מורכבות**: מורכב
  - **המלצה**: ליצור service שמנטר חריגות תקציב, עיכובים, תפוגת היתרים

## ג. ממשק משתמש

### ✅ קיים ומיושם
| מסך | פירוט |
|-----|-------|
| **דף דשבורד** | `/dashboard` |
| כותרת | "לוח בקרה ניהולי" עם תאריך נוכחי |
| כפתורי פעולה מהירה | מעבר לרשימת פרויקטים, יצירת פרויקט חדש |
| כרטיסי KPI | סה"כ פרויקטים, פרויקטים פעילים, סה"כ אנשי מקצוע |
| מקטע התראות | רשימת התראות לפי סוג |
| גרף סטטוסים | תרשים התפלגות סטטוסי פרויקטים |
| טבלת פרויקטים | פרויקטים הדורשים תשומת לב |

## ד. הרשאות

| פעולה | מנהל ראשי | מנהל פרויקט | יזם | רואה חשבון |
|-------|-----------|-------------|-----|------------|
| צפייה בדשבורד | ✅ | ✅ | ✅ | ✅ |
| צפייה בכל הפרויקטים | ✅ | ❌ (רק משויכים) | ❌ (רק משויכים) | ✅ |

## ה. כללי עסקיים

### ✅ קיים ומיושם
- הצגת נתונים בעברית RTL
- עיצוב רספונסיבי למובייל ודסקטופ

### ❌ חסר
- **חישוב KPIs אמיתי** - צריך לשאוב מהנתונים
- **התראות אוטומטיות** על:
  - חריגה תקציבית > 10%
  - איחור במשימות מעל 7 ימים
  - היתרים שפוגים ב-30 יום הקרובים
  - מכרזים שעברו הדדליין

## ו. נקודות קצה API

### ❌ חסר (אין Backend)
הנתונים נשמרים ב-localStorage

---

# 2. פרויקטים (Projects)

## א. כללי
| פרט | פירוט |
|-----|-------|
| **שם המודול** | פרויקטים / Projects |
| **מטרה** | ניהול מרכזי של כל פרויקטי הבנייה והנדל"ן |
| **משתמשי יעד** | מנהלי פרויקטים, מנהלים ראשיים, יזמים |

## ב. מבנה נתונים

### ✅ קיים ומיושם - Project Entity

| שדה | טיפוס | חובה | תיאור |
|-----|-------|------|-------|
| id | string | ✓ | מזהה ייחודי |
| project_name | string | ✓ | שם הפרויקט |
| client_name | string | ✓ | שם הלקוח |
| address | string | ✗ | כתובת |
| status | ProjectStatus | ✓ | סטטוס הפרויקט |
| permit_start_date | string (ISO) | ✗ | תאריך התחלת היתר |
| permit_duration_months | number | ✗ | משך היתר בחודשים |
| permit_target_date | string (ISO) | ✗ | תאריך יעד (מחושב) |
| permit_approval_date | string (ISO) | ✗ | תאריך אישור היתר |
| notes | string | ✗ | הערות |
| created_at | string (ISO) | ✓ | תאריך יצירה |
| updated_at_text | string | ✓ | טקסט עדכון אחרון |

### ✅ Enums - ProjectStatus
```typescript
type ProjectStatus =
  | 'תכנון'    // Planning
  | 'היתרים'   // Permits
  | 'מכרזים'   // Tenders
  | 'ביצוע'    // Execution
  | 'מסירה'    // Delivery
  | 'ארכיון';  // Archive
```

## ג. ממשק משתמש

### ✅ קיים ומיושם

| מסך | נתיב | תיאור |
|-----|------|-------|
| רשימת פרויקטים | `/projects` | כרטיסי פרויקטים עם סינון וחיפוש |
| יצירת פרויקט | `/projects/new` | טופס יצירת פרויקט חדש |
| פרטי פרויקט | `/projects/:id` | דף פרטי פרויקט עם לשוניות |

### לשוניות בדף פרטי פרויקט:
1. **סקירה כללית (OverviewTab)** - פרטי הפרויקט הבסיסיים
2. **משימות ואבני דרך (TasksMilestonesTab)** - ניהול משימות וגאנט
3. **תקציב (BudgetTab)** - ניהול תקציבי
4. **שינויים בתכנון (PlanningChangesTab)** - מעקב שינויים
5. **בעיות מיוחדות (SpecialIssuesTab)** - מעקב בעיות
6. **מכרזים (TendersTab)** - ניהול מכרזים
7. **אנשי מקצוע (ProfessionalsTab)** - צוות הפרויקט
8. **קבצים (FilesTab)** - מסמכים

### פעולות זמינות:
| פעולה | כפתור | תיאור |
|-------|-------|-------|
| יצירה | "פרויקט חדש" | יצירת פרויקט חדש |
| עריכה | "עריכת פרויקט" | מעבר למצב עריכה |
| שמירה | "שמור" | שמירת שינויים |
| ביטול | "ביטול" | ביטול עריכה |

### סינון וחיפוש:
- סינון לפי סטטוס
- חיפוש לפי שם פרויקט או לקוח

## ד. הרשאות

| פעולה | מנהל ראשי | מנהל פרויקט | יזם | רואה חשבון |
|-------|-----------|-------------|-----|------------|
| צפייה בכל הפרויקטים | ✅ | ❌ | ❌ | ✅ |
| צפייה בפרויקטים משויכים | ✅ | ✅ | ✅ | ✅ |
| יצירת פרויקט | ✅ | ✅ | ❌ | ❌ |
| עריכת פרויקט | ✅ | ✅ (משויכים) | ❌ | ❌ |
| מחיקת פרויקט | ✅ | ❌ | ❌ | ❌ |

## ה. כללי עסקיים

### ✅ קיים ומיושם
- חישוב אוטומטי של תאריך יעד היתר מתאריך התחלה + משך בחודשים
- סטטוסים בעברית עם צבעים מתאימים
- Soft delete לאנשי מקצוע (שימור היסטוריה)

### ❌ חסר
- **מחיקת פרויקט** - לא מומש (רק Admin אמור לבצע)
  - **עדיפות**: נמוכה
  - **המלצה**: להוסיף Cascade delete או soft delete
- **שיוך משתמשים לפרויקט** - קיים ב-Supabase אך לא בממשק
  - **עדיפות**: גבוהה
  - **המלצה**: ליצור UI לשיוך מנהלי פרויקט ויזמים

---

# 3. משימות ואבני דרך (Tasks & Milestones)

## א. כללי
| פרט | פירוט |
|-----|-------|
| **שם המודול** | משימות ואבני דרך / Tasks & Milestones |
| **מטרה** | ניהול לוחות זמנים, משימות ואבני דרך של הפרויקט |
| **משתמשי יעד** | מנהלי פרויקטים |

## ב. מבנה נתונים

### ✅ קיים ומיושם - Task Entity

| שדה | טיפוס | חובה | תיאור |
|-----|-------|------|-------|
| id | string | ✓ | מזהה ייחודי |
| project_id | string | ✓ | מזהה פרויקט |
| title | string | ✓ | כותרת |
| description | string | ✗ | תיאור |
| status | TaskStatus | ✓ | סטטוס |
| priority | TaskPriority | ✓ | עדיפות |
| assignee_professional_id | string | ✗ | מזהה איש מקצוע |
| assignee_name | string | ✗ | שם מוקצה |
| start_date | string (ISO) | ✗ | תאריך התחלה |
| due_date | string (ISO) | ✗ | תאריך יעד |
| completed_at | string (ISO) | ✗ | תאריך השלמה |
| duration_days | number | ✗ | משך בימים |
| percent_complete | number | ✗ | אחוז השלמה (0-100) |
| external_reference_id | string | ✗ | מזהה חיצוני (WBS) |
| notes | string | ✗ | הערות |

### ✅ Enums
```typescript
type TaskStatus = 'Backlog' | 'Ready' | 'In Progress' | 'Blocked' | 'Done' | 'Canceled';
type TaskPriority = 'High' | 'Medium' | 'Low';
```

### ✅ קיים ומיושם - ProjectMilestone Entity

| שדה | טיפוס | חובה | תיאור |
|-----|-------|------|-------|
| id | string | ✓ | מזהה ייחודי |
| project_id | string | ✓ | מזהה פרויקט |
| unit_id | string | ✓ | מזהה יחידה |
| name | string | ✓ | שם אבן הדרך |
| date | string (ISO) | ✓ | תאריך יעד |
| status | MilestoneStatus | ✓ | סטטוס |
| phase | string | ✗ | שלב (גבס, ריצוף, מסירה) |
| budget_item_id | string | ✗ | קישור לפריט תקציב |
| tender_id | string | ✗ | קישור למכרז |
| budget_link_text | string | ✗ | טקסט קישור תקציב |

### ✅ קיים ומיושם - ProjectUnit Entity

| שדה | טיפוס | חובה | תיאור |
|-----|-------|------|-------|
| id | string | ✓ | מזהה ייחודי |
| project_id | string | ✓ | מזהה פרויקט |
| name | string | ✓ | שם יחידה (דירה 1, שטחים משותפים) |
| type | UnitType | ✓ | סוג יחידה |
| color | string | ✓ | צבע |
| icon | string | ✓ | אייקון |
| order | number | ✓ | סדר תצוגה |

### ✅ קיים ומיושם - GanttTask Entity

| שדה | טיפוס | חובה | תיאור |
|-----|-------|------|-------|
| id | string | ✓ | מזהה ייחודי |
| project_id | string | ✓ | מזהה פרויקט |
| milestone_id | string | ✓ | מזהה אבן דרך |
| name | string | ✓ | שם משימה |
| start_date | string (ISO) | ✓ | תאריך התחלה |
| end_date | string (ISO) | ✓ | תאריך סיום |
| duration | string | ✓ | משך ("5 ימים") |
| status | GanttTaskStatus | ✓ | סטטוס |
| priority | GanttTaskPriority | ✓ | עדיפות |
| progress | number | ✓ | התקדמות (0-100) |
| assigned_to_id | string | ✗ | מזהה אחראי |
| resource_name | string | ✗ | שם משאב |
| predecessors | string[] | ✗ | תלויות |
| type | GanttTaskType | ✓ | סוג עבודה |
| wbs | string | ✗ | WBS מ-MS Project |
| outline_level | number | ✗ | רמת היררכיה |
| ms_project_id | string | ✗ | מזהה מ-MS Project |

## ג. ממשק משתמש

### ✅ קיים ומיושם

| תצוגה | תיאור |
|-------|-------|
| **תצוגת אבני דרך** | רשימה היררכית של יחידות > אבני דרך > משימות |
| **תצוגת גאנט** | גרף גאנט ויזואלי עם ציר זמן חודשי |
| **תצוגת ציר זמן** | ציר זמן אנכי של אבני דרך |

### פעולות זמינות:
| פעולה | סטטוס | הערה |
|-------|-------|------|
| צפייה במשימות | ✅ | עובד |
| יבוא מ-MS Project | ✅ | תמיכה ב-XLSX |
| הוספת משימה ידנית | 🟡 | כפתור קיים, פונקציונליות חלקית |
| עריכת משימה | ❌ | לא מומש |
| מחיקת משימה | ❌ | לא מומש |

### 🟡 יבוא גאנט - קיים חלקית

**שדות נתמכים ביבוא:**
- שם משימה (חובה)
- תאריך התחלה מתוכנן (חובה)
- תאריך סיום מתוכנן (חובה)
- מצב פעילות (אופציונלי)
- משך (אופציונלי)
- % התקדמות (אופציונלי)
- אחראי (אופציונלי)
- רמת חלוקה / WBS (אופציונלי)
- אבן דרך (אופציונלי)
- הערות (אופציונלי)

**פורמטים נתמכים:** XLSX, XLS

**❌ לא נתמך:**
- קבצי MPP (MS Project)
- XML
- תלויות בין משימות (predecessors) - נקראות אך לא נשמרות

## ד. הרשאות

| פעולה | מנהל ראשי | מנהל פרויקט | יזם | רואה חשבון |
|-------|-----------|-------------|-----|------------|
| צפייה במשימות | ✅ | ✅ | ✅ | ✅ |
| יצירת משימה | ✅ | ✅ (משויכים) | ❌ | ❌ |
| עריכת משימה | ✅ | ✅ (משויכים) | ❌ | ❌ |
| מחיקת משימה | ✅ | ❌ | ❌ | ❌ |
| יבוא גאנט | ✅ | ✅ (משויכים) | ❌ | ❌ |

## ה. כללי עסקיים

### ✅ קיים ומיושם
- חישוב התקדמות כוללת לפי יחידה
- תצוגת "היום" בגרף גאנט
- מקרא צבעים לסוגי עבודה
- קישור אבני דרך לתקציב (טקסט)
- זיהוי וסימון משימות מאוחרות

### ❌ חסר
- **ניהול תלויות** (predecessors)
  - **עדיפות**: בינונית
  - **מורכבות**: מורכב
  - **המלצה**: להוסיף שמירת תלויות ותצוגתן בגאנט

- **עריכה ומחיקה של משימות**
  - **עדיפות**: גבוהה
  - **מורכבות**: פשוט

- **סנכרון בין Tasks ל-GanttTasks**
  - **עדיפות**: בינונית
  - **המלצה**: לאחד את שתי הישויות או ליצור מנגנון סנכרון

- **התראות על איחורים**
  - **עדיפות**: גבוהה
  - **המלצה**: ליצור התראה אוטומטית כשמשימה מאחרת

---

# 4. תקציב (Budget)

## א. כללי
| פרט | פירוט |
|-----|-------|
| **שם המודול** | תקציב / Budget |
| **מטרה** | ניהול תקציב הפרויקט בהיררכיה: קטגוריות > פרקים > פריטים > תשלומים |
| **משתמשי יעד** | מנהלי פרויקטים, רואי חשבון |

## ב. מבנה נתונים

### ✅ קיים ומיושם - BudgetCategory Entity

| שדה | טיפוס | חובה | תיאור |
|-----|-------|------|-------|
| id | string | ✓ | מזהה ייחודי |
| project_id | string | ✓ | מזהה פרויקט |
| name | string | ✓ | שם קטגוריה |
| type | BudgetCategoryType | ✓ | סוג קטגוריה |
| icon | string | ✓ | אייקון |
| color | string | ✓ | צבע |
| order | number | ✓ | סדר תצוגה |

### ✅ Enums - BudgetCategoryType
```typescript
type BudgetCategoryType = 'consultants' | 'suppliers' | 'contractors';
// יועצים | ספקים | קבלנים
```

### ✅ קיים ומיושם - BudgetChapter Entity

| שדה | טיפוס | חובה | תיאור |
|-----|-------|------|-------|
| id | string | ✓ | מזהה ייחודי |
| project_id | string | ✓ | מזהה פרויקט |
| category_id | string | ✓ | מזהה קטגוריה |
| code | string | ✗ | קוד פרק ("01", "02") |
| name | string | ✓ | שם הפרק |
| budget_amount | number | ✓ | תקציב מתוכנן |
| contract_amount | number | ✗ | סכום חוזה (לאחר מכרז) |
| order | number | ✓ | סדר תצוגה |

### ✅ קיים ומיושם - BudgetItem Entity

| שדה | טיפוס | חובה | תיאור |
|-----|-------|------|-------|
| id | string | ✓ | מזהה ייחודי |
| project_id | string | ✓ | מזהה פרויקט |
| chapter_id | string | ✓ | מזהה פרק |
| code | string | ✗ | קוד פריט ("2.1") |
| description | string | ✓ | תיאור |
| unit | string | ✗ | יחידת מידה (מ"ר, יח') |
| quantity | number | ✗ | כמות |
| unit_price | number | ✗ | מחיר ליחידה |
| total_price | number | ✓ | סה"כ לפני מע"מ |
| vat_rate | number | ✓ | שיעור מע"מ (0.17) |
| vat_amount | number | ✓ | סכום מע"מ |
| total_with_vat | number | ✓ | סה"כ כולל מע"מ |
| status | BudgetItemStatus | ✓ | סטטוס |
| supplier_id | string | ✗ | מזהה ספק |
| supplier_name | string | ✗ | שם ספק |
| tender_id | string | ✗ | מזהה מכרז |
| paid_amount | number | ✓ | סכום ששולם |
| notes | string | ✗ | הערות |

### ✅ Enums - BudgetItemStatus
```typescript
type BudgetItemStatus =
  | 'pending'      // ממתין
  | 'tender'       // במכרז
  | 'contracted'   // בהתקשרות
  | 'in-progress'  // בביצוע
  | 'completed';   // הושלם
```

### ✅ קיים ומיושם - BudgetPayment Entity

| שדה | טיפוס | חובה | תיאור |
|-----|-------|------|-------|
| id | string | ✓ | מזהה ייחודי |
| budget_item_id | string | ✓ | מזהה פריט תקציב |
| invoice_number | string | ✓ | מספר חשבונית |
| invoice_date | string (ISO) | ✓ | תאריך חשבונית |
| amount | number | ✓ | סכום לפני מע"מ |
| vat_amount | number | ✓ | סכום מע"מ |
| total_amount | number | ✓ | סה"כ לתשלום |
| status | BudgetPaymentStatus | ✓ | סטטוס |
| payment_date | string (ISO) | ✗ | תאריך תשלום בפועל |
| milestone_id | string | ✗ | קישור לאבן דרך |
| notes | string | ✗ | הערות |

### ✅ Enums - BudgetPaymentStatus
```typescript
type BudgetPaymentStatus = 'pending' | 'approved' | 'paid';
// ממתין | מאושר | שולם
```

## ג. ממשק משתמש

### ✅ קיים ומיושם

| תצוגה | תיאור |
|-------|-------|
| **תצוגת עץ** | היררכיה: קטגוריות > פרקים > פריטים |
| **תצוגת טבלה** | טבלה שטוחה של כל הפריטים עם מיון |
| **תצוגת תזרים** | גרף חודשי של תשלומים + רשימת תשלומים אחרונים |

### כרטיסי סיכום (Summary Cards):
| מדד | תיאור |
|-----|-------|
| תקציב כולל | סכום כל הפרקים |
| חוזים | סכום contract_amount |
| שולם | סכום paid_amount |
| יתרה לתשלום | סה"כ - שולם |
| התקדמות תשלום | אחוז שולם מסה"כ |

### פעולות זמינות:
| פעולה | סטטוס | הערה |
|-------|-------|------|
| צפייה בתקציב | ✅ | עובד |
| כפתור "הוסף פריט" | 🟡 | כפתור קיים, פונקציונליות לא מומשה |
| עריכת פריט | ❌ | לא מומש |
| הוספת תשלום | ❌ | לא מומש |

### 🟡 דף תקציב גלובלי - קיים חלקית
- נתיב: `/budget`
- מציג סיכום תקציב מכל הפרויקטים
- **❌ חסר:** עריכה, ייצוא לאקסל, פילוחים

## ד. הרשאות

| פעולה | מנהל ראשי | מנהל פרויקט | יזם | רואה חשבון |
|-------|-----------|-------------|-----|------------|
| צפייה בתקציב | ✅ | ✅ | ✅ | ✅ |
| עריכת תקציב | ✅ | ✅ (משויכים) | ❌ | ❌ |
| הוספת תשלום | ✅ | ✅ (משויכים) | ❌ | ❌ |

## ה. כללי עסקיים

### ✅ קיים ומיושם
- חישוב אוטומטי של מע"מ (17%)
- מחיקת תשלומים בעת מחיקת פריט (Cascade)
- סכומים מעוצבים לפורמט מטבע ישראלי

### ❌ חסר

| פונקציונליות | עדיפות | מורכבות | המלצה |
|--------------|--------|---------|--------|
| הוספת פריט תקציב | גבוהה | פשוט | מודל עם טופס |
| עריכת פריט תקציב | גבוהה | פשוט | מודל עם טופס |
| מחיקת פריט תקציב | בינונית | פשוט | אישור + cascade |
| הוספת תשלום/חשבונית | גבוהה | בינוני | מודל מפורט |
| ייצוא לאקסל | בינונית | פשוט | שימוש בספריית xlsx |
| קישור לאבן דרך | בינונית | בינוני | dropdown של אבני דרך |
| התראה על חריגה | גבוהה | בינוני | כשחוזה > תקציב או שולם > חוזה |
| אישור תשלום (workflow) | בינונית | מורכב | תהליך אישור מדורג |

---

# 5. אנשי מקצוע (Professionals)

## א. כללי
| פרט | פירוט |
|-----|-------|
| **שם המודול** | אנשי מקצוע / Professionals |
| **מטרה** | ניהול מאגר אנשי מקצוע ושיוכם לפרויקטים |
| **משתמשי יעד** | מנהלי פרויקטים, מנהלים ראשיים |

## ב. מבנה נתונים

### ✅ קיים ומיושם - Professional Entity

| שדה | טיפוס | חובה | תיאור |
|-----|-------|------|-------|
| id | string | ✓ | מזהה ייחודי |
| professional_name | string | ✓ | שם איש המקצוע |
| company_name | string | ✗ | שם החברה |
| field | string | ✓ | תחום עיסוק |
| phone | string | ✗ | טלפון |
| email | string | ✗ | אימייל |
| rating | number | ✗ | דירוג (1-5) |
| notes | string | ✗ | הערות |
| is_active | boolean | ✓ | פעיל/לא פעיל |

### ✅ קיים ומיושם - ProjectProfessional Entity (טבלת קישור)

| שדה | טיפוס | חובה | תיאור |
|-----|-------|------|-------|
| id | string | ✓ | מזהה ייחודי |
| project_id | string | ✓ | מזהה פרויקט |
| professional_id | string | ✓ | מזהה איש מקצוע |
| project_role | string | ✗ | תפקיד בפרויקט |
| source | 'Tender' \| 'Manual' | ✓ | מקור השיוך |
| related_tender_id | string | ✗ | מזהה מכרז (אם מגיע ממכרז) |
| related_tender_name | string | ✗ | שם מכרז |
| start_date | string (ISO) | ✗ | תאריך התחלה |
| end_date | string (ISO) | ✗ | תאריך סיום |
| is_active | boolean | ✓ | פעיל בפרויקט |
| notes | string | ✗ | הערות |

### ✅ תחומי עיסוק (Fields)
| ערך | תווית |
|-----|--------|
| אדריכלות | אדריכל |
| הנדסה | מהנדס |
| קבלנות | קבלן |
| חשמל | חשמלאי |
| אינסטלציה | אינסטלטור |
| עיצוב פנים | מעצב פנים |
| אחר | אחר |

## ג. ממשק משתמש

### ✅ קיים ומיושם

| מסך | נתיב | תיאור |
|-----|------|-------|
| רשימת אנשי מקצוע | `/professionals` | כרטיסים עם סינון וחיפוש |
| יצירת איש מקצוע | `/professionals/new` | טופס יצירה |
| פרטי איש מקצוע | `/professionals/:id` | כרטיס מפורט + עריכה |
| לשונית בפרויקט | `/projects/:id` (ProfessionalsTab) | אנשי מקצוע משויכים לפרויקט |

### פעולות זמינות:
| פעולה | סטטוס | הערה |
|-------|-------|------|
| הוספת איש מקצוע למאגר | ✅ | עובד |
| עריכת פרטי איש מקצוע | ✅ | עובד |
| שיוך לפרויקט (ידני) | ✅ | מהמאגר הגלובלי |
| שיוך לפרויקט (ממכרז) | ✅ | אוטומטי בבחירת זוכה |
| הסרה מפרויקט | ✅ | Soft delete (is_active=false) |
| מחיקה מהמאגר | ❌ | לא מומש |

## ד. הרשאות

| פעולה | מנהל ראשי | מנהל פרויקט | יזם | רואה חשבון |
|-------|-----------|-------------|-----|------------|
| צפייה במאגר | ✅ | ✅ | ❌ | ❌ |
| הוספה למאגר | ✅ | ✅ | ❌ | ❌ |
| עריכה | ✅ | ✅ | ❌ | ❌ |
| שיוך לפרויקט | ✅ | ✅ (משויכים) | ❌ | ❌ |

## ה. כללי עסקיים

### ✅ קיים ומיושם
- הצגת דירוג בכוכבים (1-5)
- סינון לפי תחום ומצב פעילות
- שימור היסטוריה בהסרה מפרויקט (soft delete)
- סימון מקור שיוך (מכרז/ידני)

### ❌ חסר

| פונקציונליות | עדיפות | מורכבות | המלצה |
|--------------|--------|---------|--------|
| דירוג מפורט (4 קריטריונים) | בינונית | בינוני | מהירות, זמינות, מחיר, מקצועיות |
| היסטוריית עבודות | גבוהה | בינוני | רשימת פרויקטים ומכרזים |
| היסטוריית דירוגים | בינונית | בינוני | כל הדירוגים עם תאריכים |
| מחיקה מהמאגר | נמוכה | פשוט | רק Admin |
| העלאת קבצים לאיש מקצוע | נמוכה | פשוט | קישור לFiles |

---

# 6. מכרזים (Tenders)

## א. כללי
| פרט | פירוט |
|-----|-------|
| **שם המודול** | מכרזים / Tenders |
| **מטרה** | ניהול תהליך מכרזים - מפרסום ועד בחירת זוכה |
| **משתמשי יעד** | מנהלי פרויקטים |

## ב. מבנה נתונים

### ✅ קיים ומיושם - Tender Entity

| שדה | טיפוס | חובה | תיאור |
|-----|-------|------|-------|
| id | string | ✓ | מזהה ייחודי |
| project_id | string | ✓ | מזהה פרויקט |
| tender_name | string | ✓ | שם המכרז |
| tender_type | TenderType | ✓ | סוג המכרז |
| category | string | ✗ | קטגוריה |
| description | string | ✗ | תיאור |
| status | TenderStatus | ✓ | סטטוס |
| publish_date | string (ISO) | ✗ | תאריך פרסום |
| due_date | string (ISO) | ✗ | דדליין |
| candidate_professional_ids | string[] | ✓ | מזהי מועמדים |
| winner_professional_id | string | ✗ | מזהה זוכה |
| winner_professional_name | string | ✗ | שם זוכה |
| notes | string | ✗ | הערות |

### ✅ Enums
```typescript
type TenderStatus = 'Draft' | 'Open' | 'Closed' | 'WinnerSelected' | 'Canceled';
type TenderType = 'architect' | 'engineer' | 'contractor' | 'electrician'
                 | 'plumber' | 'interior_designer' | 'other';
```

### ✅ קיים ומיושם - TenderParticipant Entity

| שדה | טיפוס | חובה | תיאור |
|-----|-------|------|-------|
| id | string | ✓ | מזהה ייחודי |
| tender_id | string | ✓ | מזהה מכרז |
| professional_id | string | ✓ | מזהה איש מקצוע |
| quote_file | string | ✗ | קישור לקובץ הצעה |
| total_amount | number | ✗ | סכום הצעה |
| notes | string | ✗ | הערות |
| is_winner | boolean | ✓ | האם זוכה |
| created_at | string (ISO) | ✓ | תאריך הוספה |

## ג. ממשק משתמש

### ✅ קיים ומיושם

| פעולה | תיאור |
|-------|-------|
| יצירת מכרז | מודל עם שם, סוג, דדליין, תיאור |
| הוספת משתתפים | בחירה מרובה מהמאגר עם סינון לפי סוג |
| עדכון פרטי הצעה | סכום, קובץ, הערות לכל משתתף |
| בחירת זוכה | בחירה מרשימת המשתתפים |
| מחיקת מכרז | עם אישור |
| הסרת משתתף | לפני בחירת זוכה |

### תצוגות:
- כרטיסים למכרזים עם סטטוס וסוג
- רשימת משתתפים לכל מכרז
- סימון מיוחד לזוכה

## ד. הרשאות

| פעולה | מנהל ראשי | מנהל פרויקט | יזם | רואה חשבון |
|-------|-----------|-------------|-----|------------|
| צפייה במכרזים | ✅ | ✅ | ✅ | ✅ |
| יצירת מכרז | ✅ | ✅ (משויכים) | ❌ | ❌ |
| עריכת מכרז | ✅ | ✅ (משויכים) | ❌ | ❌ |
| בחירת זוכה | ✅ | ✅ (משויכים) | ❌ | ❌ |
| מחיקת מכרז | ✅ | ❌ | ❌ | ❌ |

## ה. כללי עסקיים

### ✅ קיים ומיושם
- סימון אוטומטי של מכרזים שעבר הדדליין
- שיוך אוטומטי של זוכה לפרויקט (ProjectProfessional)
- סינון משתתפים פוטנציאליים לפי סוג מכרז
- מניעת הוספת משתתפים אחרי בחירת זוכה

### ❌ חסר

| פונקציונליות | עדיפות | מורכבות | המלצה |
|--------------|--------|---------|--------|
| השוואת הצעות (טבלה) | בינונית | פשוט | טבלה side-by-side |
| יצירת שורת תקציב אוטומטית | גבוהה | בינוני | אחרי בחירת זוכה |
| העלאת קבצי הצעה אמיתית | גבוהה | פשוט | אינטגרציה עם Files |
| הודעה למשתתפים | נמוכה | מורכב | דורש מערכת התראות |
| ערעור על החלטה | נמוכה | בינוני | workflow נוסף |
| תבניות מכרז | נמוכה | פשוט | ברירות מחדל לסוגים |

---

# 7. קבצים (Files)

## א. כללי
| פרט | פירוט |
|-----|-------|
| **שם המודול** | קבצים / Files |
| **מטרה** | ניהול מסמכים וקבצים ברמת פרויקט וגלובלית |
| **משתמשי יעד** | כל המשתמשים |

## ב. מבנה נתונים

### ✅ קיים ומיושם - File Entity

| שדה | טיפוס | חובה | תיאור |
|-----|-------|------|-------|
| id | string | ✓ | מזהה ייחודי |
| file_name | string | ✓ | שם הקובץ |
| file_url | string | ✓ | קישור לקובץ |
| file_size | number | ✗ | גודל בבייטים |
| file_size_display | string | ✗ | גודל לתצוגה ("2.4 MB") |
| file_type | string | ✗ | סוג MIME |
| description_short | string | ✗ | תיאור קצר |
| related_entity_type | FileEntityType | ✗ | סוג ישות מקושרת |
| related_entity_id | string | ✗ | מזהה ישות |
| related_entity_name | string | ✗ | שם ישות |
| uploaded_at | string (ISO) | ✓ | תאריך העלאה |
| uploaded_by | string | ✓ | שם המעלה |
| notes | string | ✗ | הערות |

### ✅ Enums
```typescript
type FileEntityType = 'Project' | 'Task' | 'Tender' | 'Professional';
```

## ג. ממשק משתמש

### ✅ קיים ומיושם

| מסך | נתיב | תיאור |
|-----|------|-------|
| קבצים גלובליים | `/files` | כל הקבצים במערכת |
| קבצי פרויקט | `/projects/:id` (FilesTab) | קבצים משויכים לפרויקט |

### פעולות זמינות:
| פעולה | סטטוס | הערה |
|-------|-------|------|
| העלאת קובץ (קישור) | ✅ | רק URL, לא העלאה אמיתית |
| עריכת מטא-דאטה | ✅ | תיאור, מעלה, הערות |
| פתיחה בחלון חדש | ✅ | לינק חיצוני |
| העתקת קישור | ✅ | ללוח |
| הסרת שיוך מפרויקט | ✅ | מנתק קישור |
| חיפוש | ✅ | לפי שם, תיאור, מעלה |
| דפדוף | ✅ | 10 פריטים בעמוד |

### סוגי קבצים מזוהים:
| סוג | סיומות | אייקון |
|-----|--------|--------|
| PDF | .pdf | picture_as_pdf |
| תמונה | .jpg, .jpeg, .png, .gif, .webp | image |
| גיליון | .xlsx, .xls | grid_on |
| מסמך | .doc, .docx | description |
| ארכיון | .zip, .rar | folder_zip |
| אחר | * | insert_drive_file |

## ד. הרשאות

| פעולה | מנהל ראשי | מנהל פרויקט | יזם | רואה חשבון |
|-------|-----------|-------------|-----|------------|
| צפייה בקבצים | ✅ | ✅ | ✅ | ✅ |
| העלאת קובץ | ✅ | ✅ (משויכים) | ❌ | ❌ |
| מחיקת קובץ | ✅ | ❌ | ❌ | ❌ |

## ה. כללי עסקיים

### ✅ קיים ומיושם
- זיהוי אוטומטי של סוג קובץ לפי סיומת
- קישור לישויות (פרויקט, משימה, מכרז, איש מקצוע)
- חיפוש וסינון

### ❌ חסר

| פונקציונליות | עדיפות | מורכבות | המלצה |
|--------------|--------|---------|--------|
| העלאה אמיתית | גבוהה | מורכב | Supabase Storage / S3 |
| תצוגה מקדימה | בינונית | בינוני | לתמונות ו-PDF |
| ניהול גרסאות | נמוכה | מורכב | שמירת היסטוריה |
| מחיקה אמיתית | בינונית | פשוט | רק Admin |
| מגבלות גודל | בינונית | פשוט | הגדרה בהעלאה |
| ארגון בתיקיות | נמוכה | בינוני | מבנה היררכי |
| שיתוף חיצוני | נמוכה | מורכב | קישורים זמניים |

---

# 8. רישוי (Permits/Licensing)

## א. כללי
| פרט | פירוט |
|-----|-------|
| **שם המודול** | רישוי / Permits |
| **מטרה** | מעקב אחר היתרים ורישיונות הנדרשים לפרויקט |
| **משתמשי יעד** | מנהלי פרויקטים |

## ב. סטטוס מימוש

### ❌ לא קיים - המודול לא מומש

מודול הרישוי לא קיים כלל בקוד הנוכחי.

### 💡 המלצה למימוש

#### מבנה נתונים מוצע - Permit Entity

| שדה | טיפוס | חובה | תיאור |
|-----|-------|------|-------|
| id | string | ✓ | מזהה ייחודי |
| project_id | string | ✓ | מזהה פרויקט |
| permit_type | PermitType | ✓ | סוג היתר |
| permit_name | string | ✓ | שם ההיתר |
| authority | string | ✓ | רשות מאשרת |
| application_reference | string | ✗ | מספר בקשה |
| application_date | string (ISO) | ✗ | תאריך הגשה |
| status | PermitStatus | ✓ | סטטוס |
| approval_date | string (ISO) | ✗ | תאריך אישור |
| permit_number | string | ✗ | מספר היתר |
| valid_from | string (ISO) | ✗ | תוקף מ- |
| valid_until | string (ISO) | ✗ | תוקף עד |
| notes | string | ✗ | הערות |

#### Enums מוצעים
```typescript
type PermitType =
  | 'building'     // היתר בנייה
  | 'fire'         // אישור כיבוי אש
  | 'municipality' // אישור עירייה
  | 'electricity'  // חיבור חשמל
  | 'water'        // חיבור מים
  | 'form4'        // טופס 4
  | 'occupancy'    // אישור אכלוס
  | 'other';

type PermitStatus =
  | 'draft'           // טיוטה
  | 'submitted'       // הוגש
  | 'under_review'    // בבדיקה
  | 'conditions'      // התקבלו תנאים
  | 'approved'        // אושר
  | 'rejected'        // נדחה
  | 'expired';        // פג תוקף
```

#### מבנה נתונים מוצע - PermitCondition Entity

| שדה | טיפוס | חובה | תיאור |
|-----|-------|------|-------|
| id | string | ✓ | מזהה ייחודי |
| permit_id | string | ✓ | מזהה היתר |
| description | string | ✓ | תיאור התנאי |
| responsible_professional_id | string | ✗ | גורם אחראי |
| due_date | string (ISO) | ✗ | תאריך יעד |
| status | 'open' \| 'in_progress' \| 'completed' | ✓ | סטטוס |
| completion_date | string (ISO) | ✗ | תאריך השלמה |
| notes | string | ✗ | הערות |

### פונקציונליות נדרשת

| פונקציונליות | עדיפות | מורכבות |
|--------------|--------|---------|
| רשימת היתרים לפרויקט | גבוהה | פשוט |
| הוספת היתר חדש | גבוהה | פשוט |
| עדכון סטטוס | גבוהה | פשוט |
| ניהול תנאים | גבוהה | בינוני |
| התראות על תפוגה | גבוהה | בינוני |
| העלאת מסמכי היתר | בינונית | פשוט |
| היסטוריית שינויים | נמוכה | בינוני |
| לוח שנה היתרים | נמוכה | בינוני |

---

# 9. שינויים בתכנון (Planning Changes)

## א. כללי
| פרט | פירוט |
|-----|-------|
| **שם המודול** | שינויים בתכנון / Planning Changes |
| **מטרה** | תיעוד ומעקב אחר שינויים בתכנון הפרויקט |
| **משתמשי יעד** | מנהלי פרויקטים |

## ב. מבנה נתונים

### ✅ קיים ומיושם - PlanningChange Entity

| שדה | טיפוס | חובה | תיאור |
|-----|-------|------|-------|
| id | string | ✓ | מזהה ייחודי |
| project_id | string | ✓ | מזהה פרויקט |
| change_number | number | ✓ | מספר שינוי (אוטומטי) |
| description | string | ✓ | תיאור השינוי |
| schedule_impact | string | ✗ | השפעה על לו"ז |
| budget_impact | number | ✗ | השפעה על תקציב (₪) |
| decision | PlanningChangeDecision | ✓ | החלטה |
| created_by | string | ✗ | מזהה יוצר |
| created_at | string (ISO) | ✓ | תאריך יצירה |
| updated_at | string (ISO) | ✓ | תאריך עדכון |

### ✅ Enums
```typescript
type PlanningChangeDecision = 'pending' | 'approved' | 'rejected';
// ממתין להחלטה | אושר | נדחה
```

## ג. ממשק משתמש

### ✅ קיים ומיושם

| פעולה | תיאור |
|-------|-------|
| הוספת שינוי | מודל עם כל השדות |
| עריכת שינוי | אותו מודל במצב עריכה |
| מחיקת שינוי | עם אישור |
| צפייה בטבלה | דסקטופ - טבלה, מובייל - כרטיסים |

### עמודות טבלה:
- מספר שינוי
- תיאור השינוי
- השפעה על לו"ז
- השפעה על תקציב
- החלטה (badge צבעוני)
- תאריך יצירה
- פעולות

## ד. הרשאות

| פעולה | מנהל ראשי | מנהל פרויקט | יזם | רואה חשבון |
|-------|-----------|-------------|-----|------------|
| צפייה | ✅ | ✅ | ✅ | ✅ |
| יצירה | ✅ | ✅ (משויכים) | ❌ | ❌ |
| עריכה | ✅ | ✅ (משויכים) | ❌ | ❌ |
| מחיקה | ✅ | ✅ (משויכים) | ❌ | ❌ |

## ה. כללי עסקיים

### ✅ קיים ומיושם
- מספור אוטומטי של שינויים לפי פרויקט
- סכומים בפורמט מטבע ישראלי
- badges צבעוניים לסטטוס החלטה

### ❌ חסר

| פונקציונליות | עדיפות | מורכבות | המלצה |
|--------------|--------|---------|--------|
| קישור לפריט תקציב | בינונית | בינוני | עדכון תקציב אוטומטי |
| קישור למשימות | בינונית | בינוני | עדכון לו"ז |
| workflow אישור | נמוכה | מורכב | תהליך מדורג |
| התראה לנוגעים בדבר | נמוכה | מורכב | דורש מערכת התראות |
| ייצוא לדוח | נמוכה | פשוט | PDF/Excel |

---

# 10. בעיות מיוחדות (Special Issues)

## א. כללי
| פרט | פירוט |
|-----|-------|
| **שם המודול** | בעיות מיוחדות / Special Issues |
| **מטרה** | מעקב אחר בעיות ותקלות בפרויקט |
| **משתמשי יעד** | מנהלי פרויקטים |

## ב. מבנה נתונים

### ✅ קיים ומיושם - SpecialIssue Entity

| שדה | טיפוס | חובה | תיאור |
|-----|-------|------|-------|
| id | string | ✓ | מזהה ייחודי |
| project_id | string | ✓ | מזהה פרויקט |
| date | string (ISO) | ✓ | תאריך הבעיה |
| description | string | ✓ | תיאור הבעיה |
| status | SpecialIssueStatus | ✓ | סטטוס |
| resolution | string | ✗ | פתרון |
| created_by | string | ✗ | מזהה יוצר |
| created_at | string (ISO) | ✓ | תאריך יצירה |
| updated_at | string (ISO) | ✓ | תאריך עדכון |

### ✅ Enums
```typescript
type SpecialIssueStatus = 'open' | 'in_progress' | 'resolved';
// פתוח | בטיפול | נפתר
```

## ג. ממשק משתמש

### ✅ קיים ומיושם

| פעולה | תיאור |
|-------|-------|
| הוספת בעיה | מודל עם תאריך, תיאור, סטטוס |
| עריכת בעיה | כולל הוספת פתרון |
| מחיקת בעיה | עם אישור |
| סינון לפי סטטוס | dropdown |
| תצוגת מונה בעיות פתוחות | badge אדום |

### עמודות טבלה:
- תאריך
- תיאור הבעיה
- סטטוס (badge צבעוני)
- פתרון
- פעולות

## ד. הרשאות

| פעולה | מנהל ראשי | מנהל פרויקט | יזם | רואה חשבון |
|-------|-----------|-------------|-----|------------|
| צפייה | ✅ | ✅ | ✅ | ✅ |
| יצירה | ✅ | ✅ (משויכים) | ❌ | ❌ |
| עריכה | ✅ | ✅ (משויכים) | ❌ | ❌ |
| מחיקה | ✅ | ✅ (משויכים) | ❌ | ❌ |

## ה. כללי עסקיים

### ✅ קיים ומיושם
- הצגת שדה פתרון רק כשסטטוס = "נפתר"
- סינון לפי סטטוס
- ספירת בעיות פתוחות

### ❌ חסר

| פונקציונליות | עדיפות | מורכבות | המלצה |
|--------------|--------|---------|--------|
| שיוך לאיש מקצוע אחראי | בינונית | פשוט | dropdown מצוות הפרויקט |
| התראה על בעיות פתוחות מעל X ימים | בינונית | בינוני | כלל עסקי + התראה |
| העלאת תמונות | בינונית | פשוט | קישור ל-Files |
| קטגוריות בעיות | נמוכה | פשוט | enum נוסף |
| היסטוריית שינויים | נמוכה | בינוני | audit trail |

---

# G. תהליכים בין מודולים

## תהליך 1: הוספת אנשי מקצוע למכרז בפרויקט

### ✅ קיים ומיושם

```
1. נקודת כניסה: לשונית מכרזים בדף פרויקט
   └─ כפתור "הוסף מכרז"

2. יצירת מכרז:
   ├─ שדות חובה: שם מכרז, סוג מכרז, דדליין
   ├─ שדות אופציונליים: תיאור
   └─ סטטוס התחלתי: Open

3. הוספת אנשי מקצוע למכרז:
   ├─ בחירה מהמאגר הגלובלי
   ├─ סינון אוטומטי לפי סוג מכרז
   └─ בחירה מרובה

4. הגשת הצעות:
   ├─ עדכון סכום הצעה לכל משתתף
   ├─ קישור לקובץ הצעה (URL)
   └─ הערות

5. בחירת זוכה:
   ├─ בחירה מרשימת המשתתפים
   ├─ אישור ("האם אתה בטוח?")
   └─ סטטוס מכרז → WinnerSelected

6. לאחר בחירת זוכה:
   ├─ ✅ איש המקצוע נוסף אוטומטית לפרויקט
   ├─ ✅ מקור = "Tender" עם קישור למכרז
   └─ ❌ לא נוצרת שורת תקציב אוטומטית
```

### ❌ חסר בתהליך

| שלב | מה חסר | עדיפות |
|-----|--------|--------|
| בחירת זוכה | יצירת שורת תקציב אוטומטית | גבוהה |
| בחירת זוכה | התראה לזוכה | נמוכה |
| בחירת זוכה | התראה למפסידים | נמוכה |
| לאחר בחירה | שלב חוזה/הסכם | בינונית |

---

## תהליך 2: יבוא משימות מ-Gantt / MS Project

### ✅ קיים ומיושם

```
1. העלאת קובץ:
   ├─ פורמטים נתמכים: XLSX, XLS
   └─ ❌ לא נתמך: MPP, XML

2. ניתוח ותצוגה מקדימה:
   ├─ זיהוי אוטומטי של כותרות
   ├─ מיפוי עמודות ידני
   └─ שדות חובה: שם, תאריך התחלה, תאריך סיום

3. טיפול בקונפליקטים:
   ├─ משימות קיימות מזוהות לפי external_reference_id או שם+תאריך
   ├─ התנהגות: עדכון (לא יצירת כפילויות)
   └─ תצוגה מקדימה עם אזהרות

4. היררכיה ומבנה:
   ├─ ❌ משימות אב/ילד לא נתמכות
   └─ ❌ רמות outline לא נשמרות

5. תלויות:
   ├─ ❌ predecessors נקראים אך לא נשמרים
   └─ ❌ אין תצוגה ויזואלית של תלויות

6. אבני דרך:
   ├─ 🟡 זיהוי חלקי (שדה milestone_link)
   └─ ❌ אין יצירה אוטומטית של Milestone

7. לאחר יבוא:
   ├─ ✅ מסך סיכום (נוצרו X, עודכנו Y, שגיאות Z)
   ├─ ✅ משימות מתווספות לטבלת Tasks
   └─ ❌ אין גאנט אוטומטי - הנתונים ב-TasksMilestonesTab הם mock
```

### ❌ חסר בתהליך

| שלב | מה חסר | עדיפות |
|-----|--------|--------|
| העלאה | תמיכה ב-MPP | גבוהה |
| ניתוח | תמיכה ב-XML | בינונית |
| היררכיה | שמירת מבנה parent/child | בינונית |
| תלויות | שמירת predecessors | בינונית |
| תלויות | תצוגה בגאנט | בינונית |
| אבני דרך | יצירה אוטומטית | בינונית |
| לאחר יבוא | סנכרון עם TasksMilestonesTab | גבוהה |
| לאחר יבוא | אפשרות ביטול (undo) | נמוכה |

---

## תהליך 3: הוספת חשבונית וקישור לתקציב

### ❌ לא מומש

התהליך לא מומש כלל בממשק המשתמש, למרות שמבנה הנתונים (BudgetPayment) קיים.

### 💡 תהליך מוצע

```
1. נקודת כניסה:
   ├─ מלשונית תקציב בפרויקט
   └─ מתוך פריט תקציב ספציפי

2. פרטי חשבונית:
   ├─ מספר חשבונית (חובה)
   ├─ תאריך חשבונית (חובה)
   ├─ סכום לפני מע"מ (חובה)
   ├─ סכום מע"מ (מחושב אוטומטית)
   ├─ סה"כ (מחושב אוטומטית)
   ├─ תנאי תשלום (אופציונלי)
   ├─ קובץ חשבונית מצורף (אופציונלי)
   └─ הערות (אופציונלי)

3. קישור לתקציב:
   ├─ בחירה מרשימת פרקים/פריטים
   ├─ הצעות אוטומטיות לפי ספק
   └─ אפשרות לפיצול על מספר שורות

4. קישור לספק/איש מקצוע:
   ├─ חיבור לאיש מקצוע מהמאגר
   └─ יצירה חדשה אם לא קיים

5. תהליך אישור:
   ├─ סטטוסים: ממתין → מאושר → שולם
   ├─ מי מאשר? (לפי תפקיד)
   └─ תאריך ואמצעי תשלום

6. השפעה על תקציב:
   ├─ עדכון paid_amount בפריט התקציב
   └─ התראה אם חריגה מהתקציב
```

---

## תהליך 4: מעקב תשלומים לפי אבני דרך

### 🟡 קיים חלקית

מבנה הנתונים תומך (BudgetPayment.milestone_id), אך אין ממשק.

### 💡 תהליך מוצע

```
1. קישור אבן דרך לתשלום:
   ├─ בהגדרת אבן הדרך: budget_item_id
   └─ בהגדרת תשלום: milestone_id

2. הגדרת לוח תשלומים:
   ├─ אבן דרך X → תשלום Y%
   └─ תבניות לוח תשלומים

3. השלמת אבן דרך:
   ├─ סימון אבן דרך כהושלמה
   └─ יצירת בקשת תשלום אוטומטית

4. בקשת תשלום:
   ├─ פרטי הבקשה
   ├─ מסמכים תומכים
   └─ אישור וביצוע

5. דשבורד תשלומים:
   ├─ תשלומים צפויים
   ├─ תשלומים באיחור
   └─ תזרים מזומנים
```

---

## תהליך 5: מעקב רישוי והיתרים

### ❌ לא מומש

ראה מודול 8 להמלצות מימוש.

---

## תהליך 6: דירוג איש מקצוע אחרי סיום עבודה

### 🟡 קיים חלקית

קיים שדה rating באיש מקצוע, אך:
- ❌ אין טופס דירוג מפורט (4 קריטריונים)
- ❌ אין trigger אוטומטי לדירוג
- ❌ אין היסטוריית דירוגים

### 💡 תהליך מוצע

```
1. טריגר לדירוג:
   ├─ אחרי סיום מכרז/עבודה
   ├─ אחרי סיום אבן דרך
   └─ טריגר ידני ע"י מנהל

2. קריטריוני דירוג:
   ├─ מהירות (Speed/Timeliness)
   ├─ זמינות (Availability)
   ├─ מחיר (Price/Value)
   └─ מקצועיות (Professionalism/Quality)

3. סקאלה: 1-5 כוכבים לכל קריטריון

4. חישוב דירוג:
   ├─ ממוצע משוקלל?
   └─ שילוב עם דירוגים קודמים

5. היסטוריית דירוגים:
   ├─ כל הדירוגים עם תאריכים
   ├─ מאיזה פרויקט/מכרז
   └─ מי דירג

6. שימוש בדירוג:
   ├─ סינון אנשי מקצוע
   ├─ מיון בתוצאות
   └─ Badges (Top Rated)
```

---

## תהליך 7: העלאת קבצים ושיוך

### 🟡 קיים חלקית

שיוך קיים, אך העלאה רק בקישור URL.

### 💡 שיפורים מוצעים

```
1. נקודות העלאה:
   ├─ דף קבצים גלובלי
   ├─ לשונית קבצים בפרויקט
   ├─ ממכרז (קובץ הצעה)
   ├─ מחשבונית (סריקה)
   └─ מהיתר (מסמכים)

2. שיוך מרובה:
   └─ קובץ אחד → מספר ישויות

3. Versioning:
   ├─ העלאת גרסה חדשה
   └─ שמירת היסטוריה

4. בקרת גישה:
   ├─ קבצים פרטיים
   └─ שיתוף עם לקוחות
```

---

# H. קשרים בין מודולים

## תרשים קשרים

```
┌─────────────┐
│   Project   │
└──────┬──────┘
       │
       ├──────────────────────────────────────────────────────┐
       │                                                      │
       ▼                                                      ▼
┌──────────────┐  1:N  ┌────────────────┐  1:N  ┌──────────────────┐
│    Tasks     │◄──────│   Milestones   │◄──────│    GanttTasks    │
└──────────────┘       └────────────────┘       └──────────────────┘
                              │
                              │ N:1 (optional)
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                         Budget Module                            │
│  ┌────────────────┐  1:N  ┌───────────────┐  1:N  ┌───────────┐ │
│  │ BudgetCategory │◄──────│ BudgetChapter │◄──────│BudgetItem │ │
│  └────────────────┘       └───────────────┘       └─────┬─────┘ │
│                                                         │       │
│                                                    1:N  │       │
│                                                         ▼       │
│                                                  ┌─────────────┐│
│                                                  │BudgetPayment││
│                                                  └─────────────┘│
└─────────────────────────────────────────────────────────────────┘
       │
       │
       ▼
┌──────────────┐  N:M  ┌────────────────────┐  N:1  ┌──────────────┐
│   Tenders    │◄─────►│TenderParticipants  │──────►│ Professionals│
└──────────────┘       └────────────────────┘       └──────────────┘
       │                                                   ▲
       │ winner_professional_id                            │
       └───────────────────────────────────────────────────┘
                                                           │
                                                           │
┌──────────────────────────────────────────────────────────┤
│                 ProjectProfessional (N:M)                │
└──────────────────────────────────────────────────────────┘

┌──────────────┐       ┌──────────────────┐
│PlanningChange│       │  SpecialIssues   │
└──────────────┘       └──────────────────┘
       │                       │
       └───────┬───────────────┘
               │
          Project (1:N)

┌──────────────┐
│    Files     │──────► Project | Task | Tender | Professional
└──────────────┘         (related_entity_type + related_entity_id)
```

## סוגי קשרים

| ממודול | למודול | סוג קשר | חובה |
|--------|--------|---------|------|
| Project | Task | 1:N | ✗ |
| Project | Milestone | 1:N | ✗ |
| Project | BudgetCategory | 1:N | ✗ |
| Project | Tender | 1:N | ✗ |
| Project | PlanningChange | 1:N | ✗ |
| Project | SpecialIssue | 1:N | ✗ |
| Project | Professional (via ProjectProfessional) | N:M | ✗ |
| Milestone | GanttTask | 1:N | ✗ |
| Milestone | BudgetItem | N:1 | ✗ |
| BudgetCategory | BudgetChapter | 1:N | ✗ |
| BudgetChapter | BudgetItem | 1:N | ✗ |
| BudgetItem | BudgetPayment | 1:N | ✗ |
| BudgetItem | Supplier/Professional | N:1 | ✗ |
| Tender | TenderParticipant | 1:N | ✗ |
| TenderParticipant | Professional | N:1 | ✓ |
| Tender | Professional (winner) | N:1 | ✗ |
| File | Any Entity | N:1 | ✗ |

---

# I. סיכום מצב נוכחי והמלצות

## 1. טבלת סטטוס מימוש

| מודול | סטטוס | שלמות | עדיפות | הערות |
|-------|-------|-------|--------|-------|
| Dashboard | 🟡 | 60% | גבוהה | KPIs סטטיים, חסרות התראות דינמיות |
| Projects | ✅ | 85% | - | חסר: מחיקה, שיוך משתמשים בממשק |
| Tasks & Milestones | 🟡 | 50% | גבוהה | יבוא עובד, חסר: עריכה, סנכרון |
| Budget | 🟡 | 55% | גבוהה | תצוגה עובדת, חסר: עריכה, תשלומים |
| Professionals | ✅ | 80% | בינונית | חסר: דירוג מפורט, מחיקה |
| Tenders | ✅ | 85% | - | חסר: יצירת שורת תקציב אוטומטית |
| Files | 🟡 | 60% | בינונית | חסר: העלאה אמיתית |
| Permits | ❌ | 0% | גבוהה | לא מומש כלל |
| Planning Changes | ✅ | 90% | - | חסר: קישור לתקציב/משימות |
| Special Issues | ✅ | 85% | - | חסר: שיוך אחראי |

## 2. מפת דרכים מומלצת

### שלב 1 - קריטי (לפיתוח ראשון)

| משימה | מודול | מורכבות | תלויות |
|-------|-------|---------|--------|
| הוספה/עריכה של פריטי תקציב | Budget | פשוט | - |
| הוספת תשלום/חשבונית | Budget | בינוני | פריטי תקציב |
| יצירת מודול רישוי בסיסי | Permits | בינוני | - |
| KPIs דינמיים מנתונים אמיתיים | Dashboard | בינוני | - |
| עריכת משימות שיובאו | Tasks | פשוט | - |
| סנכרון Tasks עם TasksMilestonesTab | Tasks | בינוני | - |

### שלב 2 - חשוב (לאחר שלב 1)

| משימה | מודול | מורכבות | תלויות |
|-------|-------|---------|--------|
| יצירת שורת תקציב מזוכה מכרז | Tenders+Budget | בינוני | פריטי תקציב |
| מעקב תנאי היתר | Permits | בינוני | מודול רישוי |
| התראות אוטומטיות | Dashboard | מורכב | KPIs |
| דירוג מפורט (4 קריטריונים) | Professionals | בינוני | - |
| העלאת קבצים אמיתית | Files | מורכב | Storage (Supabase) |
| ייצוא תקציב לאקסל | Budget | פשוט | - |

### שלב 3 - שיפורים (Nice to Have)

| משימה | מודול | מורכבות | תלויות |
|-------|-------|---------|--------|
| תמיכה ביבוא MPP | Tasks | מורכב | ספריה חיצונית |
| תלויות בין משימות | Tasks | מורכב | - |
| workflow אישור תשלום | Budget | מורכב | - |
| שיתוף קבצים חיצוני | Files | מורכב | Storage |
| לוח שנה היתרים | Permits | בינוני | מודול רישוי |
| היסטוריית דירוגים | Professionals | בינוני | דירוג מפורט |

## 3. שינויי Schema נדרשים

### טבלאות חדשות
```typescript
// Permit - היתר
interface Permit {
  id: string;
  project_id: string;
  permit_type: PermitType;
  permit_name: string;
  authority: string;
  application_reference?: string;
  application_date?: string;
  status: PermitStatus;
  approval_date?: string;
  permit_number?: string;
  valid_from?: string;
  valid_until?: string;
  notes?: string;
  created_at: string;
  updated_at: string;
}

// PermitCondition - תנאי היתר
interface PermitCondition {
  id: string;
  permit_id: string;
  description: string;
  responsible_professional_id?: string;
  due_date?: string;
  status: 'open' | 'in_progress' | 'completed';
  completion_date?: string;
  notes?: string;
  created_at: string;
  updated_at: string;
}

// ProfessionalRating - דירוג מפורט
interface ProfessionalRating {
  id: string;
  professional_id: string;
  project_id?: string;
  tender_id?: string;
  rated_by?: string;
  speed_rating: number; // 1-5
  availability_rating: number; // 1-5
  price_rating: number; // 1-5
  professionalism_rating: number; // 1-5
  overall_rating: number; // calculated
  comments?: string;
  created_at: string;
}
```

### שדות חדשים לטבלאות קיימות
```typescript
// Task - הוספת שדות
interface Task {
  // ... existing
  parent_task_id?: string; // for hierarchy
  predecessors?: string[]; // for dependencies
}

// BudgetItem - הוספת שדות
interface BudgetItem {
  // ... existing
  tender_winner_amount?: number; // סכום מזוכה מכרז
}
```

## 4. פערי API

### נקודות קצה חסרות (כשיעבור ל-Backend)

| Endpoint | Method | תיאור |
|----------|--------|-------|
| `/api/budget-items` | POST | הוספת פריט תקציב |
| `/api/budget-items/:id` | PUT | עדכון פריט תקציב |
| `/api/budget-items/:id` | DELETE | מחיקת פריט תקציב |
| `/api/budget-payments` | POST | הוספת תשלום |
| `/api/budget-payments/:id` | PUT | עדכון תשלום |
| `/api/permits` | CRUD | ניהול היתרים |
| `/api/permit-conditions` | CRUD | ניהול תנאי היתר |
| `/api/professional-ratings` | POST | הוספת דירוג |
| `/api/files/upload` | POST | העלאת קובץ |
| `/api/alerts` | GET | קבלת התראות |
| `/api/kpis` | GET | קבלת מדדים |

## 5. רכיבי UI חסרים

### דפים חדשים
- דף רישוי: `/projects/:id/permits`
- דף דירוג מפורט: `/professionals/:id/rate`

### קומפוננטות חדשות
- `BudgetItemForm` - טופס הוספה/עריכת פריט תקציב
- `PaymentForm` - טופס הוספת תשלום
- `PermitCard` - כרטיס היתר
- `PermitConditionsList` - רשימת תנאי היתר
- `RatingForm` - טופס דירוג מפורט
- `AlertsNotification` - הצגת התראות
- `FileUploader` - העלאת קבצים אמיתית
- `DependencyGantt` - גאנט עם תלויות

---

## סיכום

המערכת מציגה בסיס חזק עם מימוש טוב של רוב המודולים הבסיסיים. העדיפות העליונה צריכה להיות:

1. **השלמת מודול התקציב** - הוספה/עריכה של פריטים ותשלומים
2. **מימוש מודול הרישוי** - חסר לחלוטין ומהותי לעסק
3. **התראות דינמיות** - לשפר את הדשבורד

המערכת בנויה בארכיטקטורה נכונה שתאפשר התקדמות הדרגתית בלי שבירת קוד קיים.

---

*מסמך זה נוצר ב-28/12/2025*
*גרסה: 1.0*
